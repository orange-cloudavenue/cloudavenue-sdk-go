# --------------------------------------------------------------
# WARNING: This file is managed by centralized sync management system.
# Do not edit this file directly, your changes will be overwritten.
# See https://github.com/orange-cloudavenue/workflows for more information.
# --------------------------------------------------------------
name: Release

on:
  workflow_dispatch:
    inputs:
      tag:
        description: 'Tag version number (Eg: v0.1.0)'
        required: true
        type: string

permissions:
  contents: write

jobs:
  pre-check:
    name: Pre-Check
    uses: orange-cloudavenue/workflows/.github/workflows/tag_check-tag.yml@main
    with:
      tag: ${{ github.event.inputs.tag }}
    secrets:
      TOKEN: ${{ secrets.CHANGELOG_PAT }}

  golang-ci-lint:
    needs: [pre-check]
    name: "Lint"
    uses: orange-cloudavenue/workflows/.github/workflows/go_golangci-lint.yml@main
  tests:
    needs: [pre-check]
    name: "Unit Tests"
    uses: orange-cloudavenue/workflows/.github/workflows/go_unit-test.yml@main
  tag:
    needs: [golang-ci-lint, tests]
    name: Tag
    uses: orange-cloudavenue/workflows/.github/workflows/tag_create-tag.yml@main
    with:
      tag: ${{ github.event.inputs.tag }}
    secrets:
      TOKEN: ${{ secrets.CHANGELOG_PAT }}

  release-notes:
    needs: [tag]
    name: Release Notes
    uses: orange-cloudavenue/workflows/.github/workflows/release_generate-release-note.yml@main
    with:
      tag: ${{ github.event.inputs.tag }}
    secrets:
      TOKEN: ${{ secrets.CHANGELOG_PAT }}

  make-release:
    needs: [release-notes]
    uses: orange-cloudavenue/workflows/.github/workflows/release_publish-simple-release.yml@main
    with:
      tag: ${{ github.event.inputs.tag }}
      artifact-name: ${{ needs.release-notes.outputs.artifact-name }}
    secrets:
      TOKEN: ${{ secrets.CHANGELOG_PAT }}

  changelog-newversion:
    needs: [make-release]
    uses: orange-cloudavenue/workflows/.github/workflows/changelog_generate-new-version.yml@main
    with:
      tag: ${{ github.event.inputs.tag }}
    secrets:
      TOKEN: ${{ secrets.CHANGELOG_PAT }}
  
  publish-doc:
    needs: [make-release]
    name: "Publish Documentation"
    uses: orange-cloudavenue/workflows/.github/workflows/doc_publish.yml@main